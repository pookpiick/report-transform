# Comment Response Sheet – Requirements Summary

## Overview

The application converts a **Comment File** (CSV exported from PDF comments) into an **Excel Comment Response Sheet**, using a fixed template. Users can optionally merge in a **previous revision** Excel file so the output contains all prior rows followed by the new comments.

---

## 1. Inputs

### 1.1 Comment File (CSV) — required

- **Format:** CSV with headers `Page` and `Text`.
- **Encoding:** UTF-8 (with or without BOM).
- **Source:** User exports comments from a PDF manually, then uploads the resulting CSV.
- **Mapping:**  
  - `Page` → output column **Page.**  
  - `Text` → output column **OE/Owner Comment.**

### 1.2 Previous revision (Excel) — optional

- **Format:** Excel file (`.xlsx` or `.xls`) that was previously generated by this app (or has the same structure).
- **When used:** User uploads it when building on a prior revision (e.g. revision A) to append new comments (e.g. revision B).
- **When skipped:** Omitted for the first revision; only the new CSV is turned into a sheet.

### 1.3 Revision (select) — optional

- **Label:** “Revision”.
- **Options:** 12 values total: **A, B, C, D, E, F, G** and **0, 1, 2, 3, 4**.
- **Usage:** The selected value is written into the **Rev.** column for every **new** row coming from the Comment File CSV (previous rows keep their existing Rev. value).

---

## 2. Output (Excel Comment Response Sheet)

- **Template:** `output/comment_response_template.xlsx` (row 1 = title, row 2 = headers, data from row 3).
- **Columns (at least):** No., Rev., Page., OE/Owner Comment, EPC Reply, Conclusion by OE/Owener, Status (and any others defined in the template).
- **Row numbering:** “No.” is sequential (1, 2, 3, …) over the combined list: previous revision rows first, then new CSV rows.
- **Rev. column:**  
  - For rows from the **previous revision** file: keep existing Rev. (and all other column values).  
  - For rows from the **Comment File** CSV: use the selected **Revision** value.

---

## 3. Previous Revision Merge

- If a **previous revision** Excel is provided:
  - **Order:** All rows from the previous file appear first; then all rows from the new CSV.
  - **Previous rows:** Copy **all columns** from the previous file into the output (no columns dropped). Only the **No.** column is updated to the new sequential index.
  - **New rows:** Filled from the CSV and revision select; other columns (e.g. EPC Reply, Status) stay as in the template or empty.
- If no previous file is provided, the output contains only rows from the current Comment File CSV.

---

## 4. Comment File Filtering

Rows from the Comment File CSV are **excluded** from the output when:

- **Text is empty** (or only whitespace).
- **Text equals** (case-insensitive) one of: **Closed**, **Close**, **Open**, **Opened**.

Only rows that pass these rules are added as new rows in the output.

---

## 5. User Flow (Web UI)

The form is structured as three steps (each step described with its field):

1. **Step 1 — Previous revision**  
   - Upload the previous Excel file first.  
   - Skip this step if this is the first revision.

2. **Step 2 — Revision & comment file**  
   - Select the **Revision** (e.g. B).  
   - Choose the **Comment File** CSV (exported from the PDF).  
   - Revision select and “Choose CSV” sit on the same row, aligned.

3. **Step 3 — Download**  
   - User presses **“Download Comment Response Sheet”** to get the Excel file.

---

## 6. UI/UX

- **Steps:** Described inline with each field (no separate long steps list) so the form fits without scrolling on a typical window.
- **Labels:**  
  - “Comment File” for the CSV input.  
  - “Previous revision” for the optional Excel input.  
  - “Revision” for the select.
- **Layout:** Form width expanded (e.g. max-width ~560px); Step 2 uses a two-column row for revision + CSV; on narrow screens these stack.
- **File inputs:** “Choose Excel file” and “Choose CSV” text are vertically (and horizontally) centered in their boxes.
- **Theme:** Accent color blue `#217fcb` (NIPPON KOEI style), with a slightly lighter blue for hover/focus.

---

## 7. Technical Notes

- **Template:** Must exist at `output/comment_response_template.xlsx`; header row is row 2, data starts row 3.
- **Column indices:** No. = 1, Rev. = 2, Page. = 3, OE/Owner Comment = 4 (others follow template).
- **CSV:** Must have `Page` and `Text` columns; UTF-8 (with or without BOM).
- **Previous file:** All data rows (from row 3 until first empty row) are read; all columns are preserved in the output; only No. is renumbered.

---

## 8. Summary Table

| Item | Requirement |
|------|-------------|
| **Comment File** | Required CSV with `Page`, `Text`; UTF-8. |
| **Previous revision** | Optional Excel (.xlsx/.xls); all columns preserved; rows prepended. |
| **Revision** | Optional select: A–G, 0–4 → written to Rev. for new rows only. |
| **Output** | Excel from template; No. sequential; Rev. from select for new rows; previous rows unchanged except No. |
| **Filtering** | Skip CSV rows with empty Text or Text in {Closed, Close, Open, Opened} (case-insensitive). |
| **UI** | 3-step flow; steps as field descriptions; blue theme; compact layout. |
